<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>文章详情</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/article_detail.css">
</head>
<body>
    <div class="container">
        <div class="con_header">
            <div class="guide">
                <div class="title_l fl">
                    <span id="t_APIS" class="pointer fl">APIS</span><span id="t_line" class="fl">|</span><span id="t_read" class="pointer fl">悦读项目</span>
                </div>
                <div class="title_r fr">
                    <span id="log" class="pointer">登录</span>
                    <span id="reg" class="pointer">注册</span>
                    <image id="write" src="images/icon_write.png" class="pointer"></image>
                    <a id="w_article" class="pointer" href="writeArticle.html">写文章</a>
                    <div class="test_triangle_border" id="tag">
                        <div class="popup">
                            <span><em></em></span>
                            <ul>
                                <li><image src="images/icon_user.png"></image><a href="personal.html">个人中心</a></li>
                                <li><image src="images/icon_setting.png"></image><a href="userSet.html">账户设置</a></li>
                                <li><image src="images/icon_exit.png"></image><a href="login_register.html">退出登录</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="con_content">
            <div class="content">
                <div class="content_title"><span id="title" class="pointer">首设“虚拟站点”，滴滴小巴正式上线</span><image src="images/icon_share.svg" class="pointer" id="img"></image><span id="share" onclick="shareClick()" class="pointer">分享</span></div>
                <div id="wx_code">
                    <p>使用微信扫一扫</p>
                    <image src="images/wx_code.png"></image>
                </div>
                <div class="part1_con_tips">
                    <image src="images/6.png" width="36px" height="36px" class="img_1 fl pointer"></image>
                    <span class="name_1 fl pointer">吕一</span>
                    <span class="time_1 fl pointer">09:22</span>
                    <image src="images/icon_thumb_up_like.png" class="icon_1 fl pointer"></image>
                    <span class="star fl pointer">54</span>
                    <image src="images/icon_saw.png" class="img_saw fl pointer"></image>
                    <span class="explore fl pointer">2432</span>
                </div>
                <div class="title_bg">
                    <image src="images/1.png" width="100%" height="375px"></image>
                </div>
                <div class="con_article">
                    <p class="title_article">
                        <!-- 介夫子消息，12月15日滴滴小巴业务正式上线，产品首期已在北京、成都部分区域开通。开通地区的用户可通过手机客户端滴滴出行来呼叫小巴，小巴会智能计算乘客上车点和下车点，乘客选择确认后，就会通知用户和小巴“约会”的时间和地点。 -->
                    </p>
                </div>
                <div class="line"></div>
                <div class="article_talk">
                    <p>文章点评</p>
                    <textarea id="talk" placeholder="我有话要说..."></textarea>
                    <button class="pointer" id="btn_submit">提&nbsp;&nbsp;&nbsp;&nbsp;交</button>
                </div>
                <div class="update_talk">
                    <p>最近评论</p>
                    <!-- <div class="part2">
                        <div class="line" style="margin: 25px 0"></div>
                        <div class="tips">
                            <image src="images/4.png" width="36px" height="36px" class="img_1 fl pointer"></image>
                            <span class="name_1 fl pointer">娜娜</span>
                            <span class="time_1 fl pointer">09:22</span>
                            <image src="images/icon_thumb_up_like.png" class="icon_1 fl pointer"></image>
                            <span class="star fl pointer">54</span>
                        </div>
                        <p>添加一个打赏功能啊，文章报道的很好，很想打赏！</p>
                    </div>
                    <div class="part2">
                        <div class="line" style="margin: 25px 0"></div>
                        <div class="tips">
                            <image src="images/7.png" width="36px" height="36px" class="img_1 fl pointer"></image>
                            <span class="name_1 fl pointer">吕璐</span>
                            <span class="time_1 fl pointer">09:22</span>
                            <image src="images/icon_thumb_up_like.png" class="icon_1 fl pointer"></image>
                            <span class="star fl pointer">54</span>
                        </div>
                        <p>添加一个打赏功能啊，文章报道的很好，很想打赏！</p>
                    </div>
                    <div class="part2"> -->
                        <!-- <div class="line" style="margin: 25px 0"></div>
                        <div class="tips">
                            <image src="images/6.png" width="36px" height="36px" class="img_1 fl pointer"></image>
                            <span class="name_1 fl pointer">吕一</span>
                            <span class="time_1 fl pointer">09:22</span>
                            <image src="images/icon_thumb_up_like.png" class="icon_1 fl pointer"></image>
                            <span class="star fl pointer">54</span>
                        </div>
                        <p>添加一个打赏功能啊，文章报道的很好，很想打赏！</p> -->
                    <!-- </div> -->
                </div>
            </div>
            </div>
        <div class="con_footer">
            <a class="CopyRight">Copyright © 2017 apis.sh All Rights Reserved | 陕ICP备15013925号-3</a>
        </div>
    </div>
</body>
<script src="js/base.js"></script>
<script src="js/ajax.js"></script>
<script>
    var page = 1,limit = 3;
    var count = -1;   
    isLoginToken();
    //显示文章详情
    ajaxXHR('get',url+'posts/details?id=' + GetParam()["article_id"],function(data){
        switch(data.code){
            case "param_incomplete":
            alert(data.message);
            break;
            case "article_not_found":
            alert(data.message);
            break;
            default:
            var dataArr = data.data.article;
                $Id('title').innerHTML = dataArr.title;
                $Class('title_article')[0].innerHTML = dataArr.title;
                $Class('con_article')[0].insertAdjacentHTML('beforeend',dataArr.body);
                for (let index = 0; index < $Qsa('.con_article > p').length; index++) {
                    $Qsa('.con_article > p')[index].classList.add('txt_indent');                        
                }
                // $Class('img_1')[0].src = urlStatic+dataArr.author.avatar;
                $Class('name_1')[0].innerHTML = dataArr.author.name;
                $Class('time_1')[0].innerHTML = commonTimeFunc(dataArr.create_time);         
                $Class('star')[0].innerHTML = dataArr.praise_sum;
                $Class('explore')[0].innerHTML = dataArr.look_sum;
        }
    });
    //页面加载显示评论列表
    ajaxXHR('get',url+'comment/list?page='+page+'&limit='+limit+'&article='+GetParam()["article_id"],function(data){
        switch(data.code){
            case "param_incomplete":
            console.log(data.message);
            break;
            case "param_error":
            console.log(data.message);
            break;
            default :
                var str = '<div class="part2" data-id=""><div class="line" style="margin: 25px 0"></div><div class="tips"><image src="images/4.png" data-src="" width="36px" height="36px" class="img_1 fl pointer"></image><span class="name_1 fl pointer" data-id="">娜娜</span><span class="time_1 fl pointer">09:22</span><image src="images/icon_thumb_up_like.png" class="icon_1 fl pointer"></image><span class="star fl pointer">54</span></div><p class="con_body">添加一个打赏功能啊，文章报道的很好，很想打赏！</p></div>';
                var update_talk = $Class('update_talk')[0];
                var arrData = data.data.comments;
                var strTalk = '';
                for(var i = 0; i < limit; i++){
                    strTalk += str;
                }
                update_talk.insertAdjacentHTML('beforeend',strTalk);
                for(var i = 0; i < arrData.length; i++){
                    // var time = commonTimeFunc(arrData[i].create_time); //函数名和返回值命名一样会导致编译器解析错误 
                    // $Class('img_1')[i+1].src = urlStatic+localStorage.avatar;
                    $Class('name_1')[i+1].innerHTML = arrData[i].author.name;
                    $Class('time_1')[i+1].innerHTML = commonTimeFunc(arrData[i].create_time);
                    $Class('star')[i+1].innerHTML = arrData[i].praise_sum;        
                    $Class('con_body')[i].innerHTML = arrData[i].body;
                    $Class('part2')[i].dataset.id = arrData[i]._id;
                    $Class('name_1')[i+1].dataset.id = arrData[i].author._id;
                }            
        }
    });
    //发表评论操作
    $Ael($Id('btn_submit'),'click',function(){
        ajaxXHR('post',url+'comment/add',function(data){
            switch(data.code){
                case "param_incomplete":
                console.log(data.message);
                break;
                case "article_not_found":
                console.log(data.message);                
                break;
                case "account_token_invalid":
                console.log(data.message);                
                break;
                default :
                    alert(data.message);
            }
        },'token='+localStorage.token+'&body='+$Id("talk").value+'&article=' + GetParam()["article_id"]);
    });

</script>
</html>